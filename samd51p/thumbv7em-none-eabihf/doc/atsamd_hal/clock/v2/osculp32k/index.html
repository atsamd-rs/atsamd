<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Internal, ultra low power, 32 kHz oscillator"><title>atsamd_hal::clock::v2::osculp32k - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-6c3ea77c.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="atsamd_hal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0 (05f9846f8 2025-03-31)" data-channel="1.86.0" data-search-js="search-581efc7a.js" data-settings-js="settings-6dad6058.js" ><script src="../../../../static.files/storage-3a5871a4.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-4d63596a.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../atsamd_hal/index.html">atsamd_<wbr>hal</a><span class="version">0.22.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module osculp32k</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#internal-ultra-low-power-32-khz-oscillator" title="Internal, ultra low power, 32 kHz oscillator">Internal, ultra low power, 32 kHz oscillator</a><ul><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#write-lock" title="Write lock">Write lock</a></li><li><a href="#example" title="Example">Example</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In atsamd_<wbr>hal::<wbr>clock::<wbr>v2</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../../index.html">atsamd_hal</a>::<wbr><a href="../../index.html">clock</a>::<wbr><a href="../index.html">v2</a></div><h1>Module <span>osculp32k</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/atsamd_hal/peripherals/clock/d5x/v2/osculp32k.rs.html#1-477">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="internal-ultra-low-power-32-khz-oscillator"><a class="doc-anchor" href="#internal-ultra-low-power-32-khz-oscillator">§</a>Internal, ultra low power, 32 kHz oscillator</h2><h3 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h3>
<p>The <code>osculp32k</code> module provides access to the 32 kHz ultra low power
internal oscillator (OSCULP32K) within the <code>OSC32KCTRL</code> peripheral.</p>
<p>The <code>OSCULP32K</code> clock is unlike most other clocks. First, it is an internal
clock that is always enabled and can’t be disabled. And second, it has two
separate outputs, one at 32 kHz and another divided down to 1 kHz. Moreover,
none, either or both of these outputs can be enabled at any given time.</p>
<p>We can see, then, that the <code>OSCULP32K</code> peripheral forms its own, miniature
clock tree. There is a 1:N producer clock that is always enabled; and there
are two possible consumer clocks that can be independently and optionally
enabled. In fact, this structure is illustrated by the <code>OSCULP32K</code>
register, which has no regular <code>ENABLE</code> bit and two different enable bits
for clock output, <code>EN32K</code> and <code>EN1K</code>.</p>
<p>To represent this structure in the type system, we divide the <code>OSCULP32K</code>
peripheral into these three clocks. Users get access to the 1:N
<a href="type.EnabledOscUlp32kBase.html" title="type atsamd_hal::clock::v2::osculp32k::EnabledOscUlp32kBase"><code>EnabledOscUlp32kBase</code></a> clock <a href="../trait.Source.html" title="trait atsamd_hal::clock::v2::Source"><code>Source</code></a> at power-on reset, which can be
consumed by both the <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a> and <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a> clocks. Note that
<code>OscUlp32k</code> and <code>OscUlp1k</code> are themselves 1:N clocks as well.</p>
<h3 id="write-lock"><a class="doc-anchor" href="#write-lock">§</a>Write lock</h3>
<p>Rhe <code>OSCULP32K</code> register has a dedicated write lock bit that will freeze its
configuration until the next power-on reset. We implement this by simply
dropping the <a href="struct.OscUlp32kBase.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kBase"><code>OscUlp32kBase</code></a> clock, which prevents any further access to
the <code>OSCULP32K</code> register.</p>
<h3 id="example"><a class="doc-anchor" href="#example">§</a>Example</h3>
<p>Creating and configuring the OSCULP32K clocks proceeds according to the
principles outlined in the <a href="../index.html" title="mod atsamd_hal::clock::v2"><code>clock</code> module documentation</a>. It is best shown
with an example.</p>
<p>Let’s start by using <a href="../fn.clock_system_at_reset.html" title="fn atsamd_hal::clock::v2::clock_system_at_reset"><code>clock_system_at_reset</code></a> to access the HAL clocking
structs.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>atsamd_hal::{
    clock::v2::{
        clock_system_at_reset,
        osculp32k::{OscUlp1k, OscUlp32k},
    },
    pac::Peripherals,
};
<span class="kw">let </span><span class="kw-2">mut </span>pac = Peripherals::take().unwrap();
<span class="kw">let </span>(buses, clocks, tokens) = clock_system_at_reset(
    pac.oscctrl,
    pac.osc32kctrl,
    pac.gclk,
    pac.mclk,
    <span class="kw-2">&amp;mut </span>pac.nvmctrl,
);</code></pre></div>
<p>Next, we can extract the <a href="type.EnabledOscUlp32kBase.html" title="type atsamd_hal::clock::v2::osculp32k::EnabledOscUlp32kBase"><code>EnabledOscUlp32kBase</code></a> clock from the <a href="../struct.Clocks.html" title="struct atsamd_hal::clock::v2::Clocks"><code>Clocks</code></a>
struct and use it to enable the <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a> and <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a> clocks.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>base = clocks.osculp32k_base;
<span class="kw">let </span>(osculp1k, base) = OscUlp1k::enable(tokens.osculp32k.osculp1k, base);
<span class="kw">let </span>(osculp32k, base) = OscUlp32k::enable(tokens.osculp32k.osculp32k, base);</code></pre></div>
<p>We can then override the calibration value read from flash at start up.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>base.set_calibration(<span class="number">128</span>);</code></pre></div>
<p>And finally, we can set the write lock bit to freeze the configuation until
the next power-on reset. Doing so also drops the <code>EnabledOscUlp32kBase</code>
clock.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>base.write_lock();</code></pre></div>
<p>The complete example is shown below.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>atsamd_hal::{
    clock::v2::{
        clock_system_at_reset,
        osculp32k::{OscUlp1k, OscUlp32k},
    },
    pac::Peripherals,
};
<span class="kw">let </span><span class="kw-2">mut </span>pac = Peripherals::take().unwrap();
<span class="kw">let </span>(buses, clocks, tokens) = clock_system_at_reset(
    pac.oscctrl,
    pac.osc32kctrl,
    pac.gclk,
    pac.mclk,
    <span class="kw-2">&amp;mut </span>pac.nvmctrl,
);
<span class="kw">let </span>base = clocks.osculp32k_base;
<span class="kw">let </span>(osculp1k, base) = OscUlp1k::enable(tokens.osculp32k.osculp1k, base);
<span class="kw">let </span>(osculp32k, <span class="kw-2">mut </span>base) = OscUlp32k::enable(tokens.osculp32k.osculp32k, base);
base.set_calibration(<span class="number">128</span>);
base.write_lock();</code></pre></div>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k">OscUlp1k</a></dt><dd>Clock representing the 1 kHz output of the <a href="struct.OscUlp32kBase.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kBase"><code>OscUlp32kBase</code></a> clock</dd><dt><a class="struct" href="struct.OscUlp1kToken.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1kToken">OscUlp1k<wbr>Token</a></dt><dd>Singleton token that can be exchanged for <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a></dd><dt><a class="struct" href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k">OscUlp32k</a></dt><dd>Clock representing the 32 kHz output of the <a href="struct.OscUlp32kBase.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kBase"><code>OscUlp32kBase</code></a> clock</dd><dt><a class="struct" href="struct.OscUlp32kBase.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kBase">OscUlp32k<wbr>Base</a></dt><dd>OSC3ULP2K base clock, which feeds the <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a> and <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a> clocks</dd><dt><a class="struct" href="struct.OscUlp32kToken.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kToken">OscUlp32k<wbr>Token</a></dt><dd>Singleton token that can be exchanged for <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a></dd><dt><a class="struct" href="struct.OscUlp32kTokens.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kTokens">OscUlp32k<wbr>Tokens</a></dt><dd>Set of tokens representing the disabled OSCULP32K clocks power-on reset</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.OscUlp1kId.html" title="enum atsamd_hal::clock::v2::osculp32k::OscUlp1kId">OscUlp1k<wbr>Id</a></dt><dd>Type representing the identity of the <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a> clock</dd><dt><a class="enum" href="enum.OscUlp32kId.html" title="enum atsamd_hal::clock::v2::osculp32k::OscUlp32kId">OscUlp32k<wbr>Id</a></dt><dd>Type representing the identity of the <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a> clock</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.EnabledOscUlp1k.html" title="type atsamd_hal::clock::v2::osculp32k::EnabledOscUlp1k">Enabled<wbr>OscUlp1k</a></dt><dd>The <a href="../struct.Enabled.html" title="struct atsamd_hal::clock::v2::Enabled"><code>Enabled</code></a> <a href="struct.OscUlp1k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp1k"><code>OscUlp1k</code></a> clock</dd><dt><a class="type" href="type.EnabledOscUlp32k.html" title="type atsamd_hal::clock::v2::osculp32k::EnabledOscUlp32k">Enabled<wbr>OscUlp32k</a></dt><dd>The <a href="../struct.Enabled.html" title="struct atsamd_hal::clock::v2::Enabled"><code>Enabled</code></a> <a href="struct.OscUlp32k.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32k"><code>OscUlp32k</code></a> clock</dd><dt><a class="type" href="type.EnabledOscUlp32kBase.html" title="type atsamd_hal::clock::v2::osculp32k::EnabledOscUlp32kBase">Enabled<wbr>OscUlp32k<wbr>Base</a></dt><dd>The <a href="../struct.Enabled.html" title="struct atsamd_hal::clock::v2::Enabled"><code>Enabled</code></a> <a href="struct.OscUlp32kBase.html" title="struct atsamd_hal::clock::v2::osculp32k::OscUlp32kBase"><code>OscUlp32kBase</code></a> clock</dd></dl></section></div></main></body></html>